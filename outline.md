# Code Explainer API — структура проекта

## Структура проекта

```
/mnt/okcomputer/output/
├── backend/
│   ├── app.py                 # Основное приложение FastAPI
│   ├── models.py              # Модели базы данных (SQLAlchemy)
│   ├── services/              # Службы бизнес-логики
│   │   ├── llm_service.py     # Интеграция с LLM (CodeLlama)
│   │   └── code_analyzer.py   # Утилиты анализа кода
│   ├── api/                   # Эндпойнты API
│   │   ├── code.py            # Эндпойнты объяснения кода
│   │   └── history.py         # Эндпойнты управления историей
│   ├── database.py            # Настройка подключения к базе данных
│   └── requirements.txt       # Зависимости Python
├── frontend/
│   ├── index.html             # Основной интерфейс приложения
│   ├── history.html           # Страница истории
│   ├── main.js                # Логика фронтенда (JavaScript)
│   └── resources/             # Статические ассеты
│       ├── hero-bg.jpg        # Фоновое изображение хедера
│       └── code-icon.png      # Иконка приложения
├── docs/                      # Документация
│   ├── API.md                 # Документация по API
│   └── setup.md               # Инструкция по настройке
└── tests/                     # Тестовые файлы
    └── test_api.py            # Тесты эндпойнтов API
```

## Ключевые компоненты

### Бэкенд (FastAPI)
1. **app.py**: основное FastAPI-приложение с настройкой CORS и подключением роутеров.
2. **models.py**: модели SQLAlchemy для `CodeExplanation` и описание схемы данных.
3. **services/llm_service.py**: интеграция с CodeLlama для генерации объяснений.
4. **services/code_analyzer.py**: утилиты для валидации и определения языка кода.
5. **api/code.py**: реализация эндпойнта `POST /code/explain`.
6. **api/history.py**: реализация эндпойнта `GET /history/explanations`.
7. **database.py**: подключение к базе SQLite и управление сессиями.

### Фронтенд (современный веб-интерфейс)
1. **index.html**: главный экран с редактором кода и блоком объяснений.
2. **history.html**: страница истории с поиском и фильтрацией.
3. **main.js**: логика взаимодействия с API и обработка UI.

### Реализация ключевых функций

#### Процесс объяснения кода
1. Пользователь отправляет код через редактор на фронтенде.
2. Фронтенд делает POST-запрос на `/code/explain`.
3. Бэкенд валидирует код и определяет язык.
4. Сервис LLM формирует объяснение с помощью CodeLlama.
5. Объяснение сохраняется в SQLite.
6. Ответ возвращается с текстом и метаданными.

#### Управление историей
1. Пользователь открывает страницу истории.
2. Фронтенд запрашивает `GET /history/explanations`.
3. Бэкенд возвращает постраничный список из базы данных.
4. Поддерживаются фильтры по языку, дате, поисковой строке.
5. Фронтенд отображает историю с сортировкой и поиском.

#### Интеграция LLM
1. Используется Hugging Face Inference API для CodeLlama 70B.
2. Для разработки доступен резервный мок-сервис.
3. Поддерживается множество языков программирования.
4. Генерируются структурированные объяснения с разбивкой по строкам.

## Технологический стек

### Бэкенд
- **Фреймворк**: FastAPI.
- **База данных**: SQLite с ORM SQLAlchemy.
- **LLM**: CodeLlama 70B (через Hugging Face API).
- **Документация**: автоматическая Swagger/OpenAPI.

### Фронтенд
- **Фреймворк**: ванильный JavaScript (ES6+).
- **Стилизация**: Tailwind CSS для адаптивного дизайна.
- **Редактор кода**: Monaco Editor (редактор VS Code).
- **Подсветка синтаксиса**: Prism.js.

### Инструменты разработки
- **Тестирование**: pytest для API-бэкенда.
- **Документация**: Markdown с описанием API.
- **Деплой**: раздача статических файлов через FastAPI.